{% extends 'base.html' %}
{% load static %}
{% block title %}
  Form {{ form_level }} Students
{% endblock %}
{% block content %}
  <div class="container-fluid">
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
      <h1 class="h3 mb-0 text-gray-800">Form {{ form_level }} Students</h1>
      <div>
        <a href="{% url 'students:student_list' %}" class="btn btn-secondary mr-2">
          <i class="fas fa-arrow-left"></i> Back to Forms
        </a>
        {% if perms.students.add_student %}
          <a href="{% url 'students:student_create' %}" class="d-none d-sm-inline-block btn btn-primary shadow-sm">
            <i class="fas fa-plus fa-sm text-white-50"></i> Add New Student
          </a>
        {% endif %}
      </div>
    </div>

    <!-- Stream Cards -->
    <div class="row mb-4">
      {% for stream_info in stream_data %}
        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-info shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                    Stream {{ stream_info.stream }}
                  </div>
                  <div class="h5 mb-0 font-weight-bold text-gray-800">
                    {{ stream_info.student_count }} Students
                  </div>
                </div>
                <div class="col-auto">
                  <i class="fas fa-stream fa-2x text-gray-300"></i>
                </div>
              </div>
              <div class="mt-3">
                <a href="{% url 'students:stream_students' form_level stream_info.stream %}" class="btn btn-info btn-sm btn-block">
                  View {{ stream_info.stream }} Stream
                </a>
              </div>
            </div>
          </div>
        </div>
      {% empty %}
        <div class="col-12">
          <div class="alert alert-info">
            No streams found for Form {{ form_level }}.
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- All Students in Form -->
    <div class="card shadow mb-4">
      <div class="card-header py-3 d-flex justify-content-between align-items-center">
        <h6 class="m-0 font-weight-bold text-primary">All Form {{ form_level }} Students ({{ total_students }} total)</h6>
        <button onclick="window.print()" class="btn btn-secondary btn-sm">
          <i class="fas fa-print"></i> Print List
        </button>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-striped table-hover" id="studentsTable">
            <thead>
              <tr>
                <th>Admission No.</th>
                <th>Full Name</th>
                <th>Stream</th>
                <th>KCPE Marks</th>
                <th>Phone Contact</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for student in students %}
                <tr>
                  <td>{{ student.admission_number }}</td>
                  <td>
                    <a href="#">{{ student.full_name }}</a>
                  </td>
                  <td>{{ student.stream }}</td>
                  <td>{{ student.kcpe_marks }}</td>
                  <td>{{ student.phone_contact }}</td>
                  <td>
                    <a href="{% url 'students:update_student' student.pk %}" class="btn btn-sm btn-info">Edit</a>
                    <a href="{% url 'students:delete_student' student.pk %}" class="btn btn-sm btn-danger">Delete</a>
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="6" class="text-center">No students found in Form {{ form_level }}.</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <style>
    @media print {
      .btn, .card-header, .d-sm-flex, .mb-4 {
        display: none !important;
      }
      .card-body {
        border: none !important;
        box-shadow: none !important;
      }
      .table {
        font-size: 12px;
      }
      .container-fluid {
        margin: 0 !important;
        padding: 0 !important;
      }
    }
  </style>
{% endblock %}