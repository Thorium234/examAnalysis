{% extends 'auth_base.html' %}
{% load static %}

{% block title %}Confirm Password Reset - Friends Kikai Boys High School{% endblock %}

{% block content %}
<div class="text-center mb-4">
    <h3 class="mb-2">Enter Reset Code</h3>
    <p class="text-muted">Check your email for the 6-digit reset code</p>
</div>

<form method="post" id="reset-confirm-form">
    {% csrf_token %}
    <div class="form-group">
        <label for="reset_code" class="form-label">Reset Code</label>
        <input type="text"
               class="form-control text-center"
               id="reset_code"
               name="reset_code"
               placeholder="000000"
               maxlength="6"
               required
               autocomplete="off"
               style="font-size: 1.5rem; letter-spacing: 0.5rem;">
        <small class="form-text text-muted">Enter the 6-digit code sent to your email</small>
    </div>

    <div class="form-group">
        <label for="new_password" class="form-label">New Password</label>
        <input type="password"
               class="form-control"
               id="new_password"
               name="new_password"
               placeholder="Enter your new password"
               required
               minlength="8">
        <small class="form-text text-muted">Password must be at least 8 characters long</small>
    </div>

    <div class="form-group">
        <label for="confirm_password" class="form-label">Confirm New Password</label>
        <input type="password"
               class="form-control"
               id="confirm_password"
               name="confirm_password"
               placeholder="Confirm your new password"
               required
               minlength="8">
    </div>

    <button type="submit" class="btn btn-primary btn-auth mt-4" id="reset-btn">
        <i class="fas fa-key mr-2"></i>Reset Password
    </button>
</form>

<div class="auth-links">
    <p class="mb-2">
        <a href="{% url 'accounts:password_reset_request' %}">Didn't receive code? Resend</a>
    </p>
    <p class="mb-0">
        <a href="{% url 'accounts:find_account' %}">Back to Sign In</a>
    </p>
</div>
{% endblock %}

{% block auth_links %}
<div class="auth-links">
    <p class="mb-0">Need help? <a href="#">Contact Support</a></p>
</div>
{% endblock %}

<script>
// Auto-format reset code input
document.getElementById('reset_code').addEventListener('input', function(e) {
    // Remove non-numeric characters
    this.value = this.value.replace(/\D/g, '');

    // Limit to 6 digits
    if (this.value.length > 6) {
        this.value = this.value.slice(0, 6);
    }
});

// Password confirmation validation
document.getElementById('confirm_password').addEventListener('input', function() {
    const newPassword = document.getElementById('new_password').value;
    const confirmPassword = this.value;

    if (newPassword !== confirmPassword) {
        this.setCustomValidity('Passwords do not match');
        this.style.borderColor = '#dc3545';
    } else {
        this.setCustomValidity('');
        this.style.borderColor = '#28a745';
    }
});

// Form submission
document.getElementById('reset-confirm-form').addEventListener('submit', function(e) {
    const btn = document.getElementById('reset-btn');
    const originalText = btn.innerHTML;
    btn.innerHTML = '<span class="loading"></span> Resetting...';
    btn.disabled = true;

    // Re-enable after 5 seconds if no redirect happens
    setTimeout(() => {
        btn.innerHTML = originalText;
        btn.disabled = false;
    }, 5000);
});
</script>